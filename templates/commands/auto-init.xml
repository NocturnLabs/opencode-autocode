<template>
<content><![CDATA[
# COMMAND: auto-init

{{INCLUDE core/identity.xml}}
{{INCLUDE core/security.xml}}

---

> [!IMPORTANT] > **DO NOT modify the configuration file (`forger.toml` or `.forger/config.toml`).**
> Your task is to set up the project structure and database, NOT to reconfigure the agent models or settings.

> [!CAUTION]
> **DO NOT create `feature_list.json`.** All features MUST be stored in the SQLite database (`.forger/progress.db`).
> Use `opencode-forger db exec "INSERT INTO features ..."` to add features. File-based tracking is deprecated.

This is the FIRST session. Set up the foundation for all future sessions.


### STEP 1: Read Project Specification

Read `{{APP_SPEC_PATH}}` in your working directory. Understand:

- What the project does
- Technology stack
- Features to build
- Success criteria

**Detect project type** to know which modules you'll need later.

---

### STEP 2: Populate Features Database

**CRITICAL: Break down the specification into SEPARATE, testable features.** Based on your analysis of `{{APP_SPEC_PATH}}` (which defines approximately **{{SPEC_FEATURE_COUNT}}** features and **{{SPEC_ENDPOINT_COUNT}}** API endpoints), insert ALL required features into the database.

> [!TIP]
> **Use `INSERT OR IGNORE` to safely re-run init without duplicate errors.**
> Column order: `category` (string), `description` (string), `passes` (integer 0), `verification_command` (string).

```bash
opencode-forger db exec "INSERT OR IGNORE INTO features (category, description, passes, verification_command) VALUES
  ('functional', 'Feature name', 0, 'test command'),
  ('functional', 'Another feature', 0, 'another command')"
```

#### Example: Game Project with 9 Core Features (BATCHED)

```bash
# ✅ DO: Batch insert features in chunks (e.g., 50 at a time) to avoid command line limits
# Ensure the 'passes' value is ALWAYS the literal number 0, WITHOUT quotes.
opencode-forger db exec "INSERT OR IGNORE INTO features (category, description, passes, verification_command) VALUES
  ('functional', 'Hero entity spawns and renders as red square', 0, 'cargo test test_hero_spawn'),
  ('functional', 'Hero moves upward automatically at constant speed', 0, 'cargo test test_hero_movement'),
  ('functional', 'Weapon system fires projectiles automatically', 0, 'cargo test test_weapon_firing'),
  ('functional', 'Zombie enemies spawn and move toward hero', 0, 'cargo test test_zombie_spawn'),
  ('functional', 'Collision detection between projectiles and zombies', 0, 'cargo test test_collision'),
  ('functional', 'Gate entities modify weapon properties on contact', 0, 'cargo test test_gate_effects'),
  ('functional', 'SQLite database persists high scores', 0, 'cargo test test_score_persistence'),
  ('style', 'UI displays current score and weapon stats', 0, 'cargo test test_ui_display'),
  ('style', 'Audio plays on weapon fire and gate contact', 0, 'cargo test test_audio')"
```

#### Requirements

| Rule             | Description                                                            |
| ---------------- | ---------------------------------------------------------------------- |
| **Granularity**  | Each feature = ONE testable behavior. Not "implement the app".         |
| **Count**        | **MINIMUM {{MIN_FEATURES_REQUIRED}} features** with {{MIN_TABLES_REQUIRED}} tables, {{MIN_ENDPOINTS_REQUIRED}} endpoints, and {{MIN_IMPLEMENTATION_STEPS_REQUIRED}} implementation steps. |
| **Depth**        | At least **{{COMPREHENSIVE_TEST_MIN_STEPS}} steps** for comprehensive coverage. |
| **Categories**   | Use the configured categories: {{FEATURE_CATEGORY_LIST}} |
| **Priorities**   | Use the configured priorities: {{PRIORITY_LEVEL_LIST}} |
| **Passes**       | ALL start with `passes = 0`                                            |
| **Verification** | {{REQUIRE_VERIFICATION_COMMAND}} verification commands (e.g. `npm test`, `pytest`, `cargo test`) |

For **narrow tests**, keep steps between {{NARROW_TEST_MIN_STEPS}} and {{NARROW_TEST_MAX_STEPS}}.

> [!IMPORTANT]
> **IT IS CATASTROPHIC TO REMOVE OR EDIT FEATURES IN FUTURE SESSIONS.**
> Features can ONLY be marked as passing. Never remove, never edit descriptions, never modify testing steps.

> [!TIP] > **Use standard test runners:**
>
> - **Node/TS:** `npm test -- --grep "feature name"` or `vitest run -t "feature"`
> - **Python:** `pytest tests/e2e/test_name.py`
> - **Rust:** `cargo test --test feature_name`
> - **Custom:** Create a `verify.sh` that takes a feature name/ID.

> **NEVER** combine multiple behaviors into one feature.
> **NEVER** use generic verification like `cargo build` — use actual test commands.
> **MONOREPO/NESTED PATHS:** If you create subdirectories (e.g., `backend/`, `frontend/`), your verification commands MUST reference them.
> - **Wrong:** `cargo test` (fails if Cargo.toml is in backend/)
> - **Right:** `cd backend && cargo test` OR `npm test --prefix frontend`
> **Ensure verification commands are executable from the root directory.**
> **For web projects:** E2E tests (Playwright) are MANDATORY. See `templates/modules/testing.xml`.
> **Need examples?** Run `opencode-forger example db --insert` or `example db --query`.
> **Stuck already?** Run `opencode-forger example vibe` for orientation.

---

### STEP 3: Create Conductor Context

Create `.conductor/` directory with context files:

```bash
mkdir -p .conductor tracks
```

Create `product.md`, `tech_stack.md`, `workflow.md` based on the spec.

---

### STEP 4: Create init.sh (One-Click Install + Launch)

Create a **one-click** setup script that:

1. **Installs** all dependencies (npm install, cargo build, go mod download, etc.)
2. **Launches** the application in development mode

> [!IMPORTANT] > `init.sh` MUST be a single-command way to go from "clone" to "running application".
> Users should be able to run `./init.sh` and see the application working.

**Example structure:**

```bash
#!/bin/bash
set -e

# Install dependencies
npm install # or cargo build, pip install -r requirements.txt, etc.

# Launch application
npm run dev # or cargo run, python app.py, etc.
```

> **Web projects:** Include port conflict prevention. Always prefer finding a free port over killing existing ones.
> If your `init.sh` uses a simple file server (like `python3 -m http.server`), ensure `index.html` is in the project root or explicitly specify the directory (e.g., `-d public`).
> See `templates/modules/javascript.xml` for template.

---

### STEP 5: Create .gitignore

Standard patterns for your tech stack (node_modules, target, **pycache**, etc.)

---

### STEP 6: Initialize Git

```bash
git init
git add .
git commit -m "Initial setup: features database, conductor context, project structure"
```

---

### STEP 7: Signal Completion

**CRITICAL: You MUST mark the database as initialized when you are finished seeding features.**

```bash
opencode-forger db init-complete
```

Then create the standard OpenCode continuation signal:

```bash
echo "CONTINUE" > .opencode-signal
```

Output: `===SESSION_COMPLETE===`

---

## Help Index

| Situation              | Module                            |
| ---------------------- | --------------------------------- |
| Web/JavaScript project | `templates/modules/javascript.xml` |
| Testing setup          | `templates/modules/testing.xml`    |
| MCP tool usage         | `templates/core/mcp_guide.xml`     |
| Orientation            | `example vibe`                    |
| Tracks                 | `example tracks`                  |
| Templates              | `example templates-guide`         |
]]></content>
</template>
