<template>
<content><![CDATA[
# Task: Generate Comprehensive Project Specification (Parallel Subagent Mode)

You are orchestrating parallel subagents to generate a production-grade project specification.

> [!CRITICAL]
> This must be a **COMPREHENSIVE, PRODUCTION-READY** specification—not an MVP. Think: what would a well-funded startup need to launch? Include ALL features, ALL endpoints, ALL database tables. Be exhaustive.

## Phase 1: Generate Blueprint (You do this directly)

First, create the foundation:

- **Project name**: Descriptive, memorable name
- **Overview**: 5-10 sentences explaining the project scope, users, and business value
- **Technology stack**: Structured with frontend, backend, database, devops subsections
- **Prerequisites**: Required tools, accounts, environment setup, and knowledge

## Phase 2: Invoke Subagents

After generating the blueprint, invoke these THREE subagents IN PARALLEL:

```
@spec-product Generate comprehensive core features and user experience sections for: {{IDEA}}

IMPORTANT: Generate 20-50 features depending on project complexity. Each feature must include:
- Name
- Detailed description (2-4 sentences)
- Sub-features (list of specific capabilities)
- Error handling approach
- Edge cases to consider
```

```
@spec-architecture Generate the complete database schema and ALL API endpoints for: {{IDEA}}

IMPORTANT: 
- Database: Define 8-20 tables with full column specifications, types, constraints, and relationships
- API Endpoints: Define 20-60 endpoints in structured <endpoint> elements with method, path, and description
```

```
@spec-quality Generate security, testing strategy, implementation steps, success criteria, and future enhancements for: {{IDEA}}

IMPORTANT: Implementation steps should have 8-15 phases with specific tasks and verification criteria.
```

## Phase 3: Aggregate and Validate

Once all subagents have returned their sections:

1. **Merge** all XML fragments into a single document
2. **Self-validate** the output:
   - Verify ALL closing tags are present
   - Ensure no truncated content
   - Confirm features have corresponding endpoints and database tables

## Output Format

> [!CRITICAL]
> Output ONLY the complete, valid XML specification. Follow the EXACT structure below—especially the nested elements.

```xml
<project_specification>
  <project_name>Name</project_name>
  <overview>5-10 detailed sentences about scope, users, differentiators</overview>
  
  <technology_stack>
    <frontend>
      <framework>Framework with justification</framework>
      <styling>CSS approach</styling>
      <state_management>State solution</state_management>
      <testing>Test framework</testing>
    </frontend>
    <backend>
      <runtime>Language/runtime</runtime>
      <framework>Framework choice</framework>
      <database>Database with justification</database>
      <auth>Auth approach</auth>
      <api_style>REST/GraphQL/tRPC</api_style>
      <testing>Test framework</testing>
    </backend>
  </technology_stack>
  
  <prerequisites>
    <environment_setup>
      - Environment variables
      - System dependencies
      - Port requirements
    </environment_setup>
  </prerequisites>

  <core_features>
    <!-- 20+ features for production-ready app -->
    <feature priority="high">
      <name>Feature Name</name>
      <description>2-4 sentence description</description>
      <sub_features>
        - Sub-feature 1
        - Sub-feature 2
      </sub_features>
      <error_handling>How errors are handled</error_handling>
      <edge_cases>Edge case considerations</edge_cases>
    </feature>
  </core_features>
  
  <ui_layout>
    <main_structure>Layout description</main_structure>
    <sidebar>Navigation structure</sidebar>
    <main_area>Primary content area</main_area>
    <modals_overlays>Dialogs and modals</modals_overlays>
  </ui_layout>

  <database_schema>
    <tables>
      <table name="users">
        <column name="id" type="uuid" constraints="PRIMARY KEY" />
        <column name="email" type="varchar(255)" constraints="UNIQUE NOT NULL" />
      </table>
    </tables>
  </database_schema>

  <api_endpoints_summary>
    <!-- 20+ endpoints -->
    <endpoint>
      <method>POST</method>
      <path>/api/v1/auth/login</path>
      <description>Authenticate user [auth: public]</description>
    </endpoint>
    <endpoint>
      <method>GET</method>
      <path>/api/v1/users/me</path>
      <description>Get current user profile [auth: required]</description>
    </endpoint>
  </api_endpoints_summary>

  <security>Security requirements and measures</security>
  
  <testing_strategy>
    <unit_tests>Unit test approach and coverage</unit_tests>
    <integration_tests>Integration test approach</integration_tests>
    <e2e_tests>End-to-end test approach</e2e_tests>
    <entry_point_verification>Entry point testing</entry_point_verification>
  </testing_strategy>
  
  <implementation_steps>
    <!-- 8-15 phases -->
    <step number="1">
      <title>Phase Title</title>
      <tasks>
        - Task 1
        - Task 2
      </tasks>
      <verification>How to verify completion</verification>
    </step>
  </implementation_steps>
  
  <success_criteria>
    <functionality>Functional requirements</functionality>
    <quality>Quality metrics</quality>
  </success_criteria>
  
  <future_enhancements>Post-launch features</future_enhancements>
</project_specification>
```

## User's Idea

{{IDEA}}

{{TESTING_PREFERENCE}}

---

ULTRATHINK
]]></content>
</template>
