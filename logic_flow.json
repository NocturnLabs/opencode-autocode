{
  "nodes": [
    {
      "id": "node_0",
      "position": { "x": 2600, "y": 100 },
      "data": {
        "label": "Run opencode-autocode",
        "type": "start",
        "description": "User initiates the tool from the CLI."
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_1",
      "position": { "x": 2600, "y": 340 },
      "data": {
        "label": "Choose Action",
        "type": "decision",
        "description": "Select between Scaffolding, Vibe loop, Config, or Utility commands."
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_2",
      "position": { "x": 1536, "y": 480 },
      "data": {
        "label": "Scaffold Project",
        "type": "process",
        "description": "Create .autocode directory, SQLite DB, and configuration files."
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_3",
      "position": { "x": 1536, "y": 828 },
      "data": {
        "label": "Creation Method",
        "type": "decision",
        "description": "Select Interactive, Default, or Spec File."
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_4",
      "position": { "x": 1152, "y": 1032 },
      "data": {
        "label": "AI Generated Spec",
        "type": "process",
        "description": "User provides project idea and testing preferences."
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_5",
      "position": { "x": 1540, "y": 1300 },
      "data": {
        "label": "OpenCode run (API)",
        "type": "api",
        "description": "Call AI to generate XML specification from description."
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_6",
      "position": { "x": 1540, "y": 1540 },
      "data": {
        "label": "Validate XML",
        "type": "decision",
        "description": "Check if generated XML matches the schema."
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_7",
      "position": { "x": 1350, "y": 1780 },
      "data": {
        "label": "Fixer Model Retry",
        "type": "process",
        "description": "Attempts to repair XML malformation (Max 5 retries)."
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_8",
      "position": { "x": 1730, "y": 1780 },
      "data": {
        "label": "Review Screen",
        "type": "process",
        "description": "Display status and preview; user can Accept, Edit, or Refine."
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_9",
      "position": { "x": 2210, "y": 580 },
      "data": {
        "label": "Autonomous Loop",
        "type": "process",
        "description": "Start the coding loop tracking progress in SQLite. Identifies pending features."
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_parallel",
      "position": { "x": 2210, "y": 750 },
      "data": {
        "label": "Parallel Mode?",
        "type": "decision",
        "description": "Check if configured for parallel execution (--parallel)."
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_coordinator",
      "position": { "x": 2600, "y": 900 },
      "data": {
        "label": "Worktree Coordinator",
        "type": "process",
        "description": "Manage git worktrees for concurrent feature implementation.",
        "metadata": {
          "action": "git worktree add",
          "symlinks": ["progress.db", ".conductor/", "autocode.toml"]
        }
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_reg_check",
      "position": { "x": 2210, "y": 900 },
      "data": {
        "label": "Regression Check",
        "type": "decision",
        "description": "Verify all previously passing features (Priority #1)."
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_10",
      "position": { "x": 2210, "y": 1220 },
      "data": {
        "label": "Phase 1: Auto-Init",
        "type": "process",
        "description": "Populate SQLite database with features from the spec if empty."
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_11",
      "position": { "x": 2210, "y": 1460 },
      "data": {
        "label": "Phase 2: Auto-Context",
        "type": "process",
        "description": "Ensure project architecture/tracks are established in .conductor/"
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_gen_continue",
      "position": { "x": 2210, "y": 1700 },
      "data": {
        "label": "Gen: Apply Template",
        "type": "process",
        "description": "Inject feature context & verification command into `auto-continue.md`",
        "metadata": {
          "template": "templates/commands/auto-continue.md",
          "injected": [
            "{{feature_id}}",
            "{{steps}}",
            "{{verification_cmd}}",
            "{{dual_model_prompts}}"
          ],
          "output": ".opencode/command/auto-continue-active.md"
        }
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_dual_model",
      "position": { "x": 2210, "y": 1940 },
      "data": {
        "label": "Dual Model?",
        "type": "decision",
        "description": "Is --single-model disabled? (Default: Yes)"
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_reasoning",
      "position": { "x": 2000, "y": 2180 },
      "data": {
        "label": "Reasoning Model",
        "type": "process",
        "description": "High-thinking model plans the approach, reads context, reviews code."
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_coder",
      "position": { "x": 2000, "y": 2420 },
      "data": {
        "label": "@coder Subagent",
        "type": "agent",
        "description": "Coding agent implementing the plan. Monitored for idle hangs (10m timeout)."
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_single_session",
      "position": { "x": 2420, "y": 2180 },
      "data": {
        "label": "Single Model Session",
        "type": "process",
        "description": "One model does planning, implementation, and review together."
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_13",
      "position": { "x": 2210, "y": 2700 },
      "data": {
        "label": "Run Verification",
        "type": "process",
        "description": "Verifier module parses output and checks exit codes (Sandboxed)."
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_14",
      "position": { "x": 2210, "y": 2940 },
      "data": {
        "label": "Test Result?",
        "type": "decision",
        "description": "Evaluate exit code of verification command."
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_stash",
      "position": { "x": 2500, "y": 3060 },
      "data": {
        "label": "Stash & Diff",
        "type": "process",
        "description": "git stash push 'autocode-failure' to capture diff."
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_gen_fix",
      "position": { "x": 1820, "y": 1050 },
      "data": {
        "label": "Gen: Fix Template",
        "type": "process",
        "description": "Inject error log, diff, and context into `auto-fix.md`",
        "metadata": {
          "template": "templates/commands/auto-fix.md",
          "injected": ["{{error_log}}", "{{git_diff}}", "{{prev_cmd}}"],
          "output": ".opencode/command/auto-fix-active.md"
        }
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_fix_session",
      "position": { "x": 1820, "y": 1300 },
      "data": {
        "label": "Fixer Session",
        "type": "process",
        "description": "Run OpenCode session focused on resolving the specific error."
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_15",
      "position": { "x": 1850, "y": 3180 },
      "data": {
        "label": "Commit & Next",
        "type": "process",
        "description": "git commit -m 'feat: ...' and mark passing in DB."
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_16",
      "position": { "x": 2500, "y": 3300 },
      "data": {
        "label": "Retry Loop",
        "type": "decision",
        "description": "Max 3 consecutive errors? If not, retry."
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_17",
      "position": { "x": 2590, "y": 580 },
      "data": {
        "label": "TUI Config Editor",
        "type": "process",
        "description": "Navigate 14 sections (Arrows/HJKL) to edit settings."
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_18",
      "position": { "x": 2970, "y": 580 },
      "data": {
        "label": "Utility Commands",
        "type": "process",
        "description": "db, templates, enhance, example, update, and notifications."
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node_19",
      "position": { "x": 2590, "y": 820 },
      "data": {
        "label": "Save & Exit",
        "type": "end",
        "description": "Press 'q' to save TUI changes and exit."
      },
      "type": "custom",
      "width": 280,
      "height": 127
    },
    {
      "id": "node-1767699483291",
      "type": "custom",
      "position": { "x": 1536, "y": 636 },
      "data": {
        "label": "Configuration Options",
        "type": "decision",
        "description": "Set user specific configuration options before generation."
      },
      "width": 280,
      "height": 127
    }
  ],
  "edges": [
    {
      "id": "e0",
      "source": "node_0",
      "target": "node_1",
      "type": "smoothstep"
    },
    {
      "id": "e1",
      "source": "node_1",
      "target": "node_2",
      "label": "Scaffold",
      "type": "smoothstep"
    },
    {
      "id": "e3",
      "source": "node_3",
      "target": "node_4",
      "label": "--interactive (AI)",
      "type": "smoothstep"
    },
    {
      "id": "e4",
      "source": "node_4",
      "target": "node_5",
      "type": "smoothstep"
    },
    {
      "id": "e5",
      "source": "node_5",
      "target": "node_6",
      "type": "smoothstep"
    },
    {
      "id": "e6",
      "source": "node_6",
      "target": "node_7",
      "label": "Fail",
      "type": "smoothstep"
    },
    {
      "id": "e7",
      "source": "node_7",
      "target": "node_6",
      "type": "smoothstep"
    },
    {
      "id": "e8",
      "source": "node_6",
      "target": "node_8",
      "label": "Valid",
      "type": "smoothstep"
    },
    {
      "id": "e9",
      "source": "node_1",
      "target": "node_9",
      "label": "vibe",
      "type": "smoothstep"
    },

    {
      "id": "e_vibe_parallel",
      "source": "node_9",
      "target": "node_parallel",
      "type": "smoothstep"
    },
    {
      "id": "e_parallel_yes",
      "source": "node_parallel",
      "target": "node_coordinator",
      "label": "Yes",
      "type": "smoothstep"
    },
    {
      "id": "e_parallel_no",
      "source": "node_parallel",
      "target": "node_reg_check",
      "label": "No",
      "type": "smoothstep"
    },

    {
      "id": "e_reg_fail",
      "source": "node_reg_check",
      "target": "node_gen_fix",
      "label": "Fail",
      "type": "smoothstep",
      "style": { "stroke": "#e74c3c", "strokeWidth": 2 }
    },
    {
      "id": "e_reg_pass",
      "source": "node_reg_check",
      "target": "node_10",
      "label": "Pass",
      "type": "smoothstep"
    },

    {
      "id": "e_fix_sess",
      "source": "node_gen_fix",
      "target": "node_fix_session",
      "type": "smoothstep"
    },
    {
      "id": "e_fix_vfy",
      "source": "node_fix_session",
      "target": "node_13",
      "type": "smoothstep"
    },

    {
      "id": "e10",
      "source": "node_10",
      "target": "node_11",
      "type": "smoothstep"
    },
    {
      "id": "e11",
      "source": "node_11",
      "target": "node_gen_continue",
      "type": "smoothstep"
    },

    {
      "id": "e_gen_dual",
      "source": "node_gen_continue",
      "target": "node_dual_model",
      "type": "smoothstep"
    },

    {
      "id": "e_dual_yes",
      "source": "node_dual_model",
      "target": "node_reasoning",
      "label": "Yes",
      "type": "smoothstep"
    },
    {
      "id": "e_dual_no",
      "source": "node_dual_model",
      "target": "node_single_session",
      "label": "No",
      "type": "smoothstep"
    },

    {
      "id": "e_reason_coder",
      "source": "node_reasoning",
      "target": "node_coder",
      "label": "Delegates",
      "type": "smoothstep"
    },
    {
      "id": "e_coder_vfy",
      "source": "node_coder",
      "target": "node_13",
      "type": "smoothstep"
    },
    {
      "id": "e_single_vfy",
      "source": "node_single_session",
      "target": "node_13",
      "type": "smoothstep"
    },

    {
      "id": "e_vfy_res",
      "source": "node_13",
      "target": "node_14",
      "type": "smoothstep"
    },

    {
      "id": "e_pass",
      "source": "node_14",
      "target": "node_15",
      "label": "Pass",
      "type": "smoothstep",
      "animated": true
    },
    {
      "id": "e_fail",
      "source": "node_14",
      "target": "node_stash",
      "label": "Fail",
      "type": "smoothstep",
      "style": { "stroke": "#e74c3c" }
    },

    {
      "id": "e_stash_retry",
      "source": "node_stash",
      "target": "node_16",
      "type": "smoothstep"
    },
    {
      "id": "e_retry_fix",
      "source": "node_16",
      "target": "node_gen_fix",
      "label": "Auto-Fix",
      "type": "smoothstep",
      "style": { "stroke": "#e74c3c" }
    },

    {
      "id": "e18",
      "source": "node_1",
      "target": "node_17",
      "label": "--config",
      "type": "smoothstep"
    },
    {
      "id": "e19",
      "source": "node_17",
      "target": "node_19",
      "type": "smoothstep"
    },
    {
      "id": "e20",
      "source": "node_1",
      "target": "node_18",
      "label": "Utils",
      "type": "smoothstep"
    },

    {
      "id": "e_scaf_opt",
      "source": "node_2",
      "target": "node-1767699483291",
      "type": "smoothstep"
    },
    {
      "id": "e_opt_meth",
      "source": "node-1767699483291",
      "target": "node_3",
      "type": "smoothstep"
    }
  ]
}
