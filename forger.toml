# forger.toml - Comprehensive Configuration for nocturnlabs-opencode-forger
#
# This file allows you to customize ALL runtime behavior without editing source code.
# Edit values here and re-run for iterative testing.

# ─────────────────────────────────────────────────────────────────────────────
# MODELS - LLM models for different tasks
# ─────────────────────────────────────────────────────────────────────────────
[models]
# Model for spec generation (interactive mode)
default = "opencode/big-pickle"

# Model for autonomous coding sessions
autonomous = "opencode/grok-code"

# Model for reasoning/planning tasks (optional, uses autonomous if not set)
reasoning = "opencode/grok-code"

# Model for enhancement discovery
enhancement = "opencode/big-pickle"

# ─────────────────────────────────────────────────────────────────────────────
# GENERATION - Spec generation behavior and requirements
# ─────────────────────────────────────────────────────────────────────────────
[generation]
# Spec complexity level: "comprehensive" (default) or "minimal"
# comprehensive = Full-featured, production-grade specs (15+ features, 10+ tables)
# minimal = Simple MVP specs (5 features, basic schema)
complexity = "comprehensive"

# Minimum requirements for "comprehensive" mode
min_features = 15
min_database_tables = 10
min_api_endpoints = 30
min_implementation_steps = 8

# Minimum requirements for "minimal" mode (when complexity = "minimal")
minimal_min_features = 5
minimal_min_database_tables = 3
minimal_min_api_endpoints = 10
minimal_min_implementation_steps = 4

# Include these sections in generated specs (set false to omit)
include_security_section = true
include_testing_strategy = true
include_devops_section = true
include_accessibility = true
include_future_enhancements = true

# ─────────────────────────────────────────────────────────────────────────────
# PATHS - File system paths and executables
# ─────────────────────────────────────────────────────────────────────────────
[paths]
# OpenCode executable search paths (in order of preference)
# Environment variables like $HOME are expanded
opencode_paths = ["opencode", "/usr/local/bin/opencode"]

# Log directory for autonomous sessions
# Uses OpenCode's native log directory:
#   Linux/macOS: $HOME/.local/share/opencode/log
#   Windows: %APPDATA%\opencode\log
log_dir = "$HOME/.local/share/opencode/log"

# Cache directory for verbalized sampling results
vs_cache_dir = ".vs-cache"

# Progress file name
progress_file = "opencode-progress.txt"

# App spec file name
app_spec_file = "app_spec.md"

# ─────────────────────────────────────────────────────────────────────────────
# AUTONOMOUS - Session control and iteration settings
# ─────────────────────────────────────────────────────────────────────────────
[autonomous]
# Seconds to wait between autonomous sessions
delay_between_sessions = 5

# Maximum iterations (0 = unlimited)
max_iterations = 0

# Log level for opencode commands: DEBUG, INFO, WARN, ERROR
log_level = "DEBUG"

# Timeout for each session in minutes (0 = no timeout)
session_timeout_minutes = 60

# Auto-commit after each feature completion
auto_commit = true

# Warn after this many non-progress iterations (0 = unlimited)
max_no_progress = 5

# ─────────────────────────────────────────────────────────────────────────────
# AGENT - Agent behavior and retry settings
# ─────────────────────────────────────────────────────────────────────────────
[agent]
# Maximum retry attempts before triggering research protocol
max_retry_attempts = 3

# Maximum research-based attempts before moving to next feature
max_research_attempts = 3

# Number of features to verify from passing list before new work
verification_sample_size = 2

# Focus on one feature at a time (true) or allow multi-feature work (false)
single_feature_focus = true

# ─────────────────────────────────────────────────────────────────────────────
# ALTERNATIVE_APPROACHES - Stuck recovery settings
# ─────────────────────────────────────────────────────────────────────────────
[alternative_approaches]
# Enable alternative approach generation when stuck (after 3 failed attempts)
enabled = true

# Number of alternative approaches to generate when stuck
num_approaches = 7

# Retry threshold: trigger alternative approach generation after this many failures
retry_threshold = 3

# Cache alternative approach results to avoid regenerating for same feature
cache_results = true

# Cache directory for alternative approach results
cache_dir = ".approach-cache"

# ─────────────────────────────────────────────────────────────────────────────
# MCP - Model Context Protocol tool preferences
# ─────────────────────────────────────────────────────────────────────────────
[mcp]
# Configure your available MCPs here (in priority order).
# Leave empty if you don't have custom MCPs - the agent will use standard tools.
#
# Recommended tools for the full NocturnLabs workflow:
#   perplexica          - Self-hosted AI search   (https://github.com/ItzCrazyKns/Perplexica)
#   deepwiki            - GitHub docs lookup      (https://deepwiki.com)
#   sequential-thinking - Structured reasoning    (https://github.com/modelcontextprotocol/servers)
#
# Example: priority_order = ["sequential-thinking"]
priority_order = []

# Required MCP tools for this project (set by spec generator based on project type)
# For web projects, this will be populated with ["chrome-devtools"]
# Leave empty - spec generator will set this automatically
required_tools = []

# Use sequential-thinking for complex decisions
use_sequential_thinking = true

# ─────────────────────────────────────────────────────────────────────────────
# FEATURES - Feature list and testing configuration
# ─────────────────────────────────────────────────────────────────────────────
[features]
# Valid feature categories
categories = [
    "functional",
    "style",
    "integration",
    "performance",
    "enhancement",
]

# Priority levels (in order)
priorities = ["critical", "high", "medium", "low"]

# Require verification_command for automated testing
require_verification_command = false

# Minimum steps for narrow tests
narrow_test_min_steps = 2
narrow_test_max_steps = 5

# Minimum steps for comprehensive tests
comprehensive_test_min_steps = 10

# ─────────────────────────────────────────────────────────────────────────────
# SCAFFOLDING - Project scaffolding settings
# ─────────────────────────────────────────────────────────────────────────────
[scaffolding]
# Initialize git repository after scaffolding
git_init = false

# Default output directory (empty = current directory)
output_dir = ""

# Create .opencode directory structure
create_opencode_dir = true

# Create scripts directory
create_scripts_dir = true

# ─────────────────────────────────────────────────────────────────────────────
# SECURITY - Security constraints for autonomous agents
# ─────────────────────────────────────────────────────────────────────────────
[security]
# Path to security allowlist file
allowlist_file = "scripts/security-allowlist.json"

# Enforce security allowlist strictly
enforce_allowlist = true

# Block dangerous command patterns
blocked_patterns = [
    "rm -rf /",
    "rm -rf ~",
    "sudo",
    "curl | bash",
    "wget | bash",
    "chmod 777",
    "> /dev/sda",
]

# ─────────────────────────────────────────────────────────────────────────────
# UI - User interface and output settings
# ─────────────────────────────────────────────────────────────────────────────
[ui]
# Show colored output
colored_output = true

# Verbose output during generation
verbose = false

# Show progress indicators
show_progress = true

# Preview lines to show for generated specs
spec_preview_lines = 25

# ─────────────────────────────────────────────────────────────────────────────
# NOTIFICATIONS - Webhook and alert settings
# ─────────────────────────────────────────────────────────────────────────────
[notifications]
# Enable webhook notifications (fired on feature completion)
webhook_enabled = false

# Webhook URL for Discord-compatible embeds
# Environment variables like $DISCORD_WEBHOOK are expanded
webhook_url = ""

# Discord Bot Token for failure notifications with interactive buttons
# Uses $DISCORD_BOT_TOKEN env var if set, otherwise uses this value
bot_token = ""

# Discord Channel ID for bot messages (per-project, required for bot notifications)
channel_id = ""
