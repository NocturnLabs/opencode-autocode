# autocode.toml - Comprehensive Configuration for yumlabs-opencode-autocode
#
# This file allows you to customize ALL runtime behavior without editing source code.
# Edit values here and re-run for iterative testing.

# ─────────────────────────────────────────────────────────────────────────────
# MODELS - LLM models for different tasks
# ─────────────────────────────────────────────────────────────────────────────
[models]
# Model for spec generation (interactive mode)
default = "opencode/big-pickle"

# Model for autonomous coding sessions
autonomous = "opencode/grok-code"

# Model for reasoning/planning tasks (optional, uses autonomous if not set)
reasoning = "opencode/grok-code"

# Model for enhancement discovery
enhancement = "opencode/big-pickle"

# ─────────────────────────────────────────────────────────────────────────────
# PATHS - File system paths and executables
# ─────────────────────────────────────────────────────────────────────────────
[paths]
# OpenCode executable search paths (in order of preference)
# Environment variables like $HOME are expanded
opencode_paths = [
    "opencode",
    "/usr/local/bin/opencode",
]

# Log directory for autonomous sessions
log_dir = "$HOME/Work/local-work/opencode-logs"

# Cache directory for verbalized sampling results
vs_cache_dir = ".vs-cache"

# Progress file name
progress_file = "opencode-progress.txt"

# Feature list file name
feature_list_file = "feature_list.json"

# App spec file name
app_spec_file = "app_spec.md"

# ─────────────────────────────────────────────────────────────────────────────
# AUTONOMOUS - Session control and iteration settings
# ─────────────────────────────────────────────────────────────────────────────
[autonomous]
# Seconds to wait between autonomous sessions
delay_between_sessions = 5

# Maximum iterations (0 = unlimited)
max_iterations = 0

# Log level for opencode commands: DEBUG, INFO, WARN, ERROR
log_level = "DEBUG"

# Timeout for each session in minutes (0 = no timeout)
session_timeout_minutes = 60

# Auto-commit after each feature completion
auto_commit = true

# ─────────────────────────────────────────────────────────────────────────────
# AGENT - Agent behavior and retry settings
# ─────────────────────────────────────────────────────────────────────────────
[agent]
# Maximum retry attempts before triggering research protocol
max_retry_attempts = 3

# Maximum research-based attempts before moving to next feature
max_research_attempts = 3

# Number of features to verify from passing list before new work
verification_sample_size = 2

# Focus on one feature at a time (true) or allow multi-feature work (false)
single_feature_focus = true

# ─────────────────────────────────────────────────────────────────────────────
# VERBALIZED_SAMPLING - Approach exploration settings
# ─────────────────────────────────────────────────────────────────────────────
[verbalized_sampling]
# Enable verbalized sampling for approach exploration
enabled = true

# Number of approaches to generate
num_approaches = 10

# Probability distribution for approach types
# Format: [min, max] probability range
conventional_probability = [0.8, 0.9]    # High probability, standard approaches
alternative_probability = [0.4, 0.6]     # Medium probability, alternative approaches  
creative_probability = [0.0, 0.2]        # Low probability, creative/unconventional

# Minimum count for each approach type
min_conventional = 2
min_alternative = 3
min_creative = 3

# Cache VS results to avoid regenerating
cache_results = true

# ─────────────────────────────────────────────────────────────────────────────
# MCP - Model Context Protocol tool preferences
# ─────────────────────────────────────────────────────────────────────────────
[mcp]
# Preferred MCP tools in priority order (first = highest priority)
priority_order = [
    "osgrep",             # Code search (prefer over grep)
    "chat-history",       # Past solutions reference
    "deepwiki",           # Official documentation
    "perplexica",         # Web search
    "sequential-thinking" # Complex reasoning
]

# Prefer osgrep over grep for code search
prefer_osgrep = true

# Use sequential-thinking for complex decisions
use_sequential_thinking = true

# ─────────────────────────────────────────────────────────────────────────────
# FEATURES - Feature list and testing configuration
# ─────────────────────────────────────────────────────────────────────────────
[features]
# Valid feature categories
categories = ["functional", "style", "integration", "performance", "enhancement"]

# Priority levels (in order)
priorities = ["critical", "high", "medium", "low"]

# Require verification_command for automated testing
require_verification_command = false

# Minimum steps for narrow tests
narrow_test_min_steps = 2
narrow_test_max_steps = 5

# Minimum steps for comprehensive tests
comprehensive_test_min_steps = 10

# ─────────────────────────────────────────────────────────────────────────────
# SCAFFOLDING - Project scaffolding settings
# ─────────────────────────────────────────────────────────────────────────────
[scaffolding]
# Initialize git repository after scaffolding
git_init = false

# Default output directory (empty = current directory)
output_dir = ""

# Create .opencode directory structure
create_opencode_dir = true

# Create scripts directory
create_scripts_dir = true

# ─────────────────────────────────────────────────────────────────────────────
# SECURITY - Security constraints for autonomous agents
# ─────────────────────────────────────────────────────────────────────────────
[security]
# Path to security allowlist file
allowlist_file = "scripts/security-allowlist.json"

# Enforce security allowlist strictly
enforce_allowlist = true

# Block dangerous command patterns
blocked_patterns = [
    "rm -rf /",
    "rm -rf ~",
    "sudo",
    "curl | bash",
    "wget | bash",
    "chmod 777",
    "> /dev/sda"
]

# ─────────────────────────────────────────────────────────────────────────────
# UI - User interface and output settings
# ─────────────────────────────────────────────────────────────────────────────
[ui]
# Show colored output
colored_output = true

# Verbose output during generation
verbose = false

# Show progress indicators
show_progress = true

# Preview lines to show for generated specs
spec_preview_lines = 25
